<div class="layout">
  <aside class="sidebar">
    <div class="brand">
      <div class="logo-wrapper">
        <img src="assets/logoandinatrading.png" alt="Andina Trading" />
      </div>
      <h2>Andina Trading</h2>
    </div>

    <div class="user-info">
      <i class="bi bi-person-circle user-icon"></i>
      <p class="username">
        {{ nombreUsuario }}
        <button class="edit-name-btn" (click)="openProfileModal()" title="Editar perfil" aria-label="Editar perfil">
          <i class="bi bi-pencil-square"></i>
        </button>
      </p>
    </div>

    <nav class="menu">
      <a routerLink="/admin/dashboard" routerLinkActive="active" class="menu-item">
        <i class="bi bi-house-door-fill"></i>
        <span>Inicio</span>
      </a>

      <a routerLink="/admin/logs" routerLinkActive="active" class="menu-item">
        <i class="bi bi-graph-up"></i>
        <span>Logs del sistema</span>
      </a>

      <a routerLink="/admin/backups" routerLinkActive="active" class="menu-item">
        <i class="bi bi-hdd-stack"></i>
        <span>Backups</span>
      </a>

      <a routerLink="/admin/historial" routerLinkActive="active" class="menu-item">
        <i class="bi bi-clock-history"></i>
        <span>Historial</span>
      </a>

      <a routerLink="/admin/usuarios" routerLinkActive="active" class="menu-item">
        <i class="bi bi-people-fill"></i>
        <span>Usuarios</span>
      </a>

      <a routerLink="/admin/analisis" routerLinkActive="active" class="menu-item">
        <i class="bi bi-people-fill"></i>
        <span>Análisis</span>
      </a>
    </nav>

    <button class="logout-btn" (click)="logout()">
      <i class="bi bi-box-arrow-right"></i> Salir
    </button>
  </aside>

  <main class="content">
    <router-outlet></router-outlet>
  </main>
</div>


<div class="neo-modal__backdrop" *ngIf="showProfileModal">
  <div class="neo-modal" role="dialog" aria-modal="true" aria-labelledby="perfilTitle">
    <div class="neo-modal__header">
      <h3 id="perfilTitle">Editar perfil</h3>
      <button class="neo-close" (click)="closeProfileModal()" aria-label="Cerrar">✕</button>
    </div>

    <div class="neo-tabs neo-tabs--segmented" [attr.data-active]="tab">
      <button
        class="seg-pill"
        [class.active]="tab==='nombre'"
        (click)="tab='nombre'"
        aria-controls="tab-nombre"
      >
        <i class="bi bi-person"></i> Nombre
      </button>
      <button
        class="seg-pill"
        [class.active]="tab==='password'"
        (click)="tab='password'"
        aria-controls="tab-password"
      >
        <i class="bi bi-shield-lock"></i> Contraseña
      </button>
      <span class="seg-indicator"></span>
    </div>

    <div class="neo-modal__body">
      <div id="tab-nombre" *ngIf="tab==='nombre'">
        <div class="form-group">
          <label>Nombre completo</label>
          <input class="neu-input-inset" type="text" [(ngModel)]="formNombre" placeholder="Ej. Ana Pérez" />
        </div>
        <p class="hint">Este nombre se mostrará en el panel.</p>
        <p class="error" *ngIf="msgError">{{ msgError }}</p>
        <p class="ok" *ngIf="msgOk">{{ msgOk }}</p>
      </div>

      <div id="tab-password" *ngIf="tab==='password'">
        <div class="form-group">
          <label>Contraseña actual</label>
          <input class="neu-input-inset" type="password" [(ngModel)]="pwd.actual" />
        </div>
        <div class="form-group">
          <label>Nueva contraseña</label>
          <input class="neu-input-inset" type="password" [(ngModel)]="pwd.nueva" />
        </div>
        <div class="form-group">
          <label>Confirmar nueva contraseña</label>
          <input class="neu-input-inset" type="password" [(ngModel)]="pwd.confirmar" />
        </div>
        <p class="hint">Mínimo 8 caracteres.</p>
        <p class="error" *ngIf="msgError">{{ msgError }}</p>
        <p class="ok" *ngIf="msgOk">{{ msgOk }}</p>
      </div>
    </div>

    <div class="neo-modal__footer neo-modal__footer--right">
      <button class="neo-btn" (click)="closeProfileModal()">Cancelar</button>
      <button class="neo-btn neo-btn--download" *ngIf="tab==='nombre'" [disabled]="saving" (click)="guardarNombre()">
        {{ saving ? 'Guardando…' : 'Guardar nombre' }}
      </button>
      <button class="neo-btn neo-btn--download" *ngIf="tab==='password'" [disabled]="saving" (click)="cambiarPassword()">
        {{ saving ? 'Actualizando…' : 'Cambiar contraseña' }}
      </button>
    </div>
  </div>
</div>

